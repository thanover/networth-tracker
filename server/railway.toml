[build]
builder = "DOCKERFILE"
dockerfilePath = "Dockerfile"
watchPatterns = ["server/**"]

[deploy]
# Pin to 8080 so the client nginx can target a known port. The inline
# assignment overrides Railway's injected PORT for the node process.
startCommand = "PORT=8080 node src/index.js"
healthcheckPath = "/api/health"
healthcheckTimeout = 100
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

# Seed a demo user with sample accounts in PR preview environments only.
# Production has no SEED_DEMO_DATA variable set, so it never seeds.
[environments.pr.variables]
SEED_DEMO_DATA = "true"

# PR environments get more restart attempts so a transient MongoDB startup
# delay can't permanently kill the preview.
[environments.pr.deploy]
restartPolicyMaxRetries = 10
